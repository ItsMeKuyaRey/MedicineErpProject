@page "/login"
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<div class="login-container">
    <div class="login-card">
        <div class="logo-container">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                </svg>
            </div>
        </div>

        <h2 class="title">Medicine ERP System</h2>
        <p class="subtitle">Sign in to your pharmacy management account</p>

        <EditForm Model="@loginModel" OnValidSubmit="HandleLogin">
            <DataAnnotationsValidator />

            <div class="form-group">
                <label for="email">Email Address</label>
                <div class="input-wrapper">
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                        </svg>
                    </span>
                    <InputText id="email" class="form-control" @bind-Value="loginModel.Email" placeholder="admin@pharmacy.com" />
                </div>
                <ValidationMessage For="@(() => loginModel.Email)" />
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <div class="input-wrapper">
                    <span class="input-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </span>
                    <InputText id="password" type="password" class="form-control" @bind-Value="loginModel.Password" placeholder="Enter your password" />
                </div>
                <ValidationMessage For="@(() => loginModel.Password)" />
            </div>

            <div class="form-options">
                <div class="remember-me">
                    <InputCheckbox id="rememberMe" @bind-Value="loginModel.RememberMe" />
                    <label for="rememberMe">Remember me</label>
                </div>
                <a href="/forgot-password" class="forgot-link">Forgot password?</a>
            </div>

            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div class="alert alert-danger">@errorMessage</div>
            }

            <button type="submit" class="btn-signin" disabled="@isLoading">
                @if (isLoading)
                {
                    <span>Signing in...</span>
                }
                else
                {
                    <span>Sign In</span>
                }
            </button>
        </EditForm>

    
    </div>
</div>

@code {
    private LoginModel loginModel = new();
    private bool isLoading = false;
    private string errorMessage = string.Empty;

    protected override void OnInitialized()
    {
        // Check if user is already authenticated
        var authState = AuthenticationStateProvider.GetAuthenticationStateAsync().Result;
        if (authState.User.Identity?.IsAuthenticated == true)
        {
            NavigationManager.NavigateTo("/");
        }
    }

    private async Task HandleLogin()
    {
        isLoading = true;
        errorMessage = string.Empty;
        StateHasChanged();

        try
        {
            // TODO: Replace with your actual authentication logic
            // Example: await AuthService.LoginAsync(loginModel.Email, loginModel.Password, loginModel.RememberMe);

            // Simulate API call
            await Task.Delay(1000);

            // For demo purposes - accept any password for demo accounts
            if (loginModel.Email.EndsWith("@pharmacy.com"))
            {
                // Successful login - redirect to dashboard
                NavigationManager.NavigateTo("/dashboard");
            }
            else
            {
                errorMessage = "Invalid email or password";
            }
        }
        catch (Exception ex)
        {
            errorMessage = "An error occurred during login. Please try again.";
            Console.WriteLine($"Login error: {ex.Message}");
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }

    public class LoginModel
    {
        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string Email { get; set; } = string.Empty;

        [Required(ErrorMessage = "Password is required")]
        public string Password { get; set; } = string.Empty;

        public bool RememberMe { get; set; }
    }
}

<style>
    .login-container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #e8f4f8 0%, #f0f9ff 100%);
        padding: 20px;
    }

    .login-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(16, 185, 129, 0.08);
        border: 1px solid #e0f2f1;
        padding: 40px;
        width: 100%;
        max-width: 400px;
    }

    .logo-container {
        display: flex;
        justify-content: center;
        margin-bottom: 24px;
    }

    .logo-icon {
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .title {
        text-align: center;
        font-size: 24px;
        font-weight: 600;
        color: #065f46;
        margin-bottom: 8px;
    }

    .subtitle {
        text-align: center;
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 32px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
    }

    .input-wrapper {
        position: relative;
    }

    .input-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        pointer-events: none;
    }

    .form-control {
        width: 100%;
        padding: 12px 12px 12px 40px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.2s;
        background: #f9fafb;
    }

    .form-control:focus {
        outline: none;
        border-color: #10b981;
        background: white;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .form-control::placeholder {
        color: #9ca3af;
    }

    .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .remember-me {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .remember-me input[type="checkbox"] {
        width: 16px;
        height: 16px;
        cursor: pointer;
    }

    .remember-me label {
        font-size: 14px;
        color: #4b5563;
        cursor: pointer;
        margin: 0;
    }

    .forgot-link {
        font-size: 14px;
        color: #059669;
        text-decoration: none;
    }

    .forgot-link:hover {
        text-decoration: underline;
        color: #047857;
    }

    .btn-signin {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2);
    }

    .btn-signin:hover:not(:disabled) {
        background: linear-gradient(135deg, #059669 0%, #047857 100%);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        transform: translateY(-1px);
    }

    .btn-signin:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .demo-accounts {
        margin-top: 24px;
        padding: 16px;
        background: #f3f4f6;
        border-radius: 8px;
    }

    .demo-title {
        font-size: 13px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
    }

    .demo-item {
        font-size: 12px;
        color: #6b7280;
        margin: 4px 0;
    }

    .alert {
        padding: 12px;
        margin-bottom: 16px;
        border-radius: 8px;
        font-size: 14px;
    }

    .alert-danger {
        background: #fef2f2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }

    .validation-message {
        color: #dc2626;
        font-size: 12px;
        margin-top: 4px;
    }
</style>